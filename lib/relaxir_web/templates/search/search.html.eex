<%= form_for @conn, Routes.search_path(@conn, :search), fn f -> %>
  <%= label f, "Search" %>
  <div class="search">
    <%= text_input f, :terms %>
    <button type="submit"><span class="grey">🔍</span></button>
  </div>
  <div class="search-checkboxes">
      <%= checkbox f, :recipes, value: @checkboxes.recipes, class: "hidden checkbox" %>
      <%= label f, :recipes, class: "button toggle-button" %>
      <%= checkbox f, :categories, value: @checkboxes.categories, class: "hidden checkbox" %>
      <%= label f, :categories, class: "button toggle-button" %>
      <%= checkbox f, :ingredients, value: @checkboxes.ingredients, class: "hidden checkbox" %>
      <%= label f, :ingredients, class: "button toggle-button" %>
      <%= checkbox f, :usda, value: @checkboxes.usda, class: "hidden checkbox" %>
      <%= label f, :usda, class: "button toggle-button" %>
      </td>
  </div>
<% end %>

<%= case @count do %>
  <% :na -> %>
  <% 0 -> %><p>No results found<p>
  <% _ -> %><p><%= @count %> results found</p>
<% end %>

<%= for {category, results} <- @results do %>
  <%= if length(results) > 0 do %>
    <h2><%= String.capitalize(category) %></h2>
  <% end %>

  <%= for {_, result, id} <- results do %>
    <%= if route_exists("#{category}/#{id}") and id != nil do %>
      <p><%= link result, to: "#{category}/#{id}"%>
      <%= if category == "recipes" do %>
        <span><%= button "+", to: Routes.recipe_list_path(@conn, :select_list, id), method: :get, class: "btn-tiny" %></span>
      <% end %>
      <%= if category == "ingredients" do %>
        <span><%= button "+", to: Routes.ingredient_path(@conn, :select_list, id), method: :get, class: "btn-tiny" %></span>
      <% end %>
      </p>
    <% else %>
      <p>
        <%= result %>
        <%= if category == "usda" do %>
          <span><%= button "+", to: Routes.ingredient_path(@conn, :create, ingredient: %{"name" => result}), class: "btn-tiny" %></span>
        <% end %>
      </p>
    <% end %>
  <% end %>
<% end %>
