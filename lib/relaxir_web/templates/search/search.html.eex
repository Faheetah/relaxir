<%= form_for @conn, Routes.search_path(@conn, :search), fn f -> %>
  <%= label f, :terms %>
  <%= text_input f, :terms %>
  <div>
    <%= submit "Search" %>
  </div>
  <table>
    <tr>
      <td>
      <%= label f, :recipes %>
      <%= checkbox f, :recipes, value: @checkboxes.recipes %>
      </td>
      <td>
      <%= label f, :categories %>
      <%= checkbox f, :categories, value: @checkboxes.categories %>
      </td>
      <td>
      <%= label f, :ingredients %>
      <%= checkbox f, :ingredients, value: @checkboxes.ingredients %>
      </td>
      <td>
      <%= label f, :usda %>
      <%= checkbox f, :usda, value: @checkboxes.usda %>
      </td>
    </tr>
  </table>
<% end %>

<%= case @count do %>
  <% :na -> %>
  <% 0 -> %><p>No results found<p>
  <% _ -> %><p><%= @count %> results found</p>
<% end %>

<%= for {category, results} <- @results do %>
  <%= if length(results) > 0 do %>
    <h2><%= String.capitalize(category) %></h2>
  <% end %>

  <%= for {_, result, id} <- results do %>
    <%= if route_exists("#{category}/#{id}") and id != nil do %>
      <p><%= link result, to: "#{category}/#{id}"%>
      <%= if category == "recipes" do %>
        <span><%= button "+", to: Routes.recipe_list_path(@conn, :select_list, id), method: :get, class: "btn-tiny" %></span>
      <% end %>
      <%= if category == "ingredients" do %>
        <span><%= button "+", to: Routes.ingredient_path(@conn, :select_list, id), method: :get, class: "btn-tiny" %></span>
      <% end %>
      </p>
    <% else %>
      <p><%= result %></p>
    <% end %>
  <% end %>
<% end %>
